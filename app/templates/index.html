{% extends "base.html" %}
{% block title %}Tasks - Task Manager{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="m-0">Tasks</h2>
  <div>
    <a class="btn btn-outline-primary" href="{{ url_for('add_task') }}">+ Add Task</a>
  </div>
</div>

<form class="row g-2 mb-3" method="get" action="{{ url_for('index') }}">
  <div class="col-sm-6 col-md-4">
    <input class="form-control" name="q" placeholder="Search title..." value="{{ q or '' }}" />
  </div>
  <div class="col-sm-4 col-md-3">
    <select class="form-select" name="category" onchange="this.form.submit()">
      <option value="">All categories</option>
      {% for c in categories %}
        <option value="{{ c.id }}" {% if selected_category == c.id %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto">
    <button class="btn btn-secondary" type="submit">Filter</button>
  </div>
</form>

{% if tasks %}
  <div class="list-group">
    {% for t in tasks %}
      <div class="list-group-item list-group-item-action mb-2">
        <div class="d-flex w-100 justify-content-between align-items-start">
          <div class="me-3">
            <h5 class="mb-1 {% if t.completed %}text-decoration-line-through text-muted{% endif %}">
              {{ t.title }}
            </h5>
            <p class="mb-1 small">{{ t.description or "" }}</p>
            <p class="mb-0 small">
              {% if t.category %}<span class="badge bg-secondary">{{ t.category.name }}</span>{% endif %}
              {% if t.deadline %}
                <span class="ms-2">Deadline: {{ t.deadline.strftime('%Y-%m-%d') }}</span>
              {% endif %}
            </p>
          </div>

          <div class="text-end">
            <form method="post" action="{{ url_for('toggle_task', task_id=t.id) }}" style="display: inline;">
              <button class="btn btn-sm btn-outline-success" title="Toggle complete" type="submit">
                {% if t.completed %}Undo{% else %}Done{% endif %}
              </button>
            </form>

            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('edit_task', task_id=t.id) }}">Edit</a>

            <form method="post" action="{{ url_for('delete_task', task_id=t.id) }}" style="display: inline;" onsubmit="return confirm('Delete this task?');">
              <button class="btn btn-sm btn-outline-danger">Delete</button>
            </form>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="text-muted">No tasks yet. <a href="{{ url_for('add_task') }}">Add your first task</a>.</p>
{% endif %}
{% endblock %}
